/* carousel.css - Carousel layout and poster structure */

/* Carousel section layout */
section {
	--r: calc(2 + var(--dir))/ 3;
	--w: clamp(4em, min(50vh, 25vw), 18em);
	/* Protect against division by zero when n <= 1 by using a minimum safe n for the tan calculation */
	--safe-n: max(2, var(--n));
	--z: calc(var(--f, 1.25)*-.5*var(--w)/tan(.5turn/var(--safe-n)));
	place-self: center;
	translate: 0 0 var(--z);
	rotate: var(--dir) calc(1 - var(--dir)) 0 calc((var(--k) + .5)*-1turn);
}

/* Poster article layout and transformations */
article,
header,
figure,
img,
figcaption {
	grid-area: 1/ 1
}

article {
	/* item progress value */
	--j: var(--i)/var(--n);
	/* linear difference between this item's progress value  
	 * and progress value of highlighted item in front - 
	 * it's a value in the [0, 1] interval */
	--dif-lin: calc(var(--j) - mod(var(--k) + 1, 1));
	/* absolute value of linear difference */
	--abs-lin: abs(var(--dif-lin));
	/* difference between middle & absolute linear difference */
	--dif-mid: calc(.5 - var(--abs-lin));
	--abs-mid: abs(var(--dif-mid));
	/* relative distance to from this item 
	 * to highlighted one in front */
	--dif-arc: calc(2*(.5 - var(--abs-mid)));
	/* relative distance limit */
	--lim: .15;
	--sel: max(0, calc((var(--lim) - var(--dif-arc))/var(--lim)));
	--out: calc(1 - var(--sel));
	--hov: 0;
	width: var(--w);
	aspect-ratio: var(--r);
	transform:
		rotate3d(var(--dir), calc(1 - var(--dir)), 0, calc(var(--j)*1turn)) translatez(var(--z)) rotate(calc(var(--dir)*.5turn)) scale(calc(1 + var(--hov)));
	transition: transform 0.35s ease-out;

	header {
		rotate: y calc(var(--hov)*.5turn)
	}

	@supports not (scale: abs(-1)) {
		--abs-lin: max(var(--dif-lin), -1*var(--dif-lin));
		--abs-mid: max(var(--dif-mid), -1*var(--dif-mid))
	}

	cursor: pointer;
}

/* Common styles for both sides of poster */
article header,
figure {
	--ang: calc(-45deg + var(--hov)*180deg);
	overflow: hidden;
	position: relative;
	border: solid 4px transparent;
	/* Make border transparent by default */
	border-radius: .5em;
	backface-visibility: hidden;
	box-shadow: 5px 5px 13px #000;
	background: #2a2359;
	pointer-events: auto;
	/* Enable click events */
	transition: .35s ease-out;
	transition-property: rotate, transform, --ang;
}

/* Back side */
article header {
	font-size: 0.45em;
	/* Further reduced font size for better fit without scrolling */
	line-height: 1.4;
	padding: 1.8em;
	text-align: left;
	display: flex;
	flex-direction: column;
	align-items: flex-start;
	overflow-y: auto;
	/* Add scrolling only if absolutely necessary */
	max-height: 100%;
	/* Ensure it doesn't overflow */
	transform: rotateZ(calc(var(--hov) * 90deg));
	transform-origin: center;
}

article header p {
	margin: 0 0 1em 0;
}

article header p:last-child {
	margin-bottom: 0;
}

/* Front side */
figure {
	rotate: y calc((1 + var(--hov))*.5turn);
	/* Maintain flip effect */
	display: flex !important;
	flex-direction: column;
	justify-content: center;
	align-items: center;
	padding: 1em;
}

figure div {
	font-size: 2.2em;
	font-weight: bold;
	text-align: center;
	line-height: 1.2;
	text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
}

/* Make image poster titles smaller than standard poster titles */
figure.image-poster-figure div.title {
	font-size: 1.1em;
	/* Smaller font size for image poster titles */
	max-width: 90%;
	/* Prevent text from overflowing */
	padding: 0.3em;
	/* Add some padding */
	background-color: rgba(0, 0, 0, 0.6);
	/* Semi-transparent background for better readability */
	border-radius: 4px;
	margin-top: 0.5em;
	/* Space between image and title */
}

/* Remove any existing background-blend-mode or opacity effects */
article header,
figure::after {
	opacity: 1;
	/* Ensure full opacity */
	background: #000;
}

/* Highlight for currently centered poster */
@keyframes pulse {
	0% {
		border-color: rgba(244, 140, 6, 0.4)
	}

	50% {
		border-color: rgba(244, 140, 6, 0.8)
	}

	100% {
		border-color: rgba(244, 140, 6, 0.4)
	}
}

article.centered header,
article.centered figure {
	animation: pulse 2s ease-in-out infinite;
	border: solid 4px rgba(244, 140, 6, 0.6);
	/* #f48c06 with opacity */
}
